
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>ArcGIS FeatureLayer Performance Demo</title>

    <link rel="stylesheet" href="https://js.arcgis.com/4.11/esri/css/main.css" />
    <script src="https://js.arcgis.com/4.11/"></script>

    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }

      #info {
        color: #888;
        font-family: "Avenir Next W00", "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 23px;
        padding: 5px;
        margin: 5px;
        width: 220px;
        text-align: center;
        border: solid 2px #666;
        border-radius: 4px;
        background-color: #fff;
      }
    </style>

    <script>
      require([
        "esri/core/watchUtils",
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/FeatureLayer",
        "esri/renderers/UniqueValueRenderer",
        "esri/symbols/SimpleLineSymbol",
        "dojo/dom",
        "dojo/domReady!"
      ], function(
        watchUtils,
        Map,
        MapView,
        FeatureLayer,
        UniqueValueRenderer,
        SimpleLineSymbol,
        dom
      ) {
        console.time("4.11 Map loaded in: ");
        var highlightHandlers = [];
        var map = new Map({
          basemap: "dark-gray"
        });

        var view = new MapView({
          container: "viewDiv",
          map: map,
          center: { x: 5.5, y: 52.0, spatialReference: 4326 },
          zoom: 8
        });

        var layer = new FeatureLayer({
          url:
            "https://services.arcgis.com/emS4w7iyWEQiulAb/arcgis/rest/services/PC4_WM/FeatureServer/0",
          outFields: ["*"]
        });

        map.add(layer);

        view.ui.add("info", "top-right");
        function changeCursor(response) {
          if (response.results.length > 0) {
            document.getElementById("viewDiv").style.cursor = "pointer";
          } else {
            document.getElementById("viewDiv").style.cursor = "default";
          }
        }

        function getGraphics(response, lview) {
          // the topmost graphic from the click location
          // and display select attribute values from the
          // graphic to the user

          highlightHandlers.forEach(function(hh, i, arr) {
            //console.log(hh);
            hh.remove();
            highlightHandlers.pop();
          });
          var graphic = response.results[0].graphic;
          highlightHandlers.push(lview.highlight(graphic));
          var attributes = graphic.attributes;
          var pc4 = attributes.PC4;
          var nrofAdresses = attributes.Aantal_adreslocaties;
          var nrofMultiParts = attributes.Aantal_multiparts;

          dom.byId("info").style.visibility = "visible";
          dom.byId("pc4").innerHTML = "Postcode: " + pc4;
          dom.byId("nrofA").innerHTML = "Adreslocaties: " + nrofAdresses;
          dom.byId("nrofMP").innerHTML = "Multiparts: " + nrofMultiParts;
        }

        view.when(function() {
          // console.log("view when");
          view.whenLayerView(layer).then(function(lview) {
            // console.log("view whenLayerView");
            watchUtils.whenFalseOnce(lview, "updating", function() {
              // console.log("whenFalseOnce");
              console.timeEnd("4.11 Map loaded in: ");
              // Set up a click event handler and retrieve the screen x, y coordinates
              view.on("pointer-move", function(evt) {
                var screenPoint = {
                  x: evt.x,
                  y: evt.y
                };
                //console.log("pointer move", screenPoint)
                // the hitTest() checks to see if any graphics in the view
                // intersect the given screen x, y coordinates
                // view.hitTest(screenPoint).then(function(response) {
                //   //console.log("hittest ", response)

                //   // changeCursor(response);
                //   getGraphics(response, lview);
                // });
              });
            });
          });
        });
      });
    </script>
  </head>

  <body>
    <div id="viewDiv"></div>
    <!-- <div id="info">
      <span id="pc4">aaa</span><br />
      <span id="nrofA">bbb</span><br />
      <span id="nrofMP">ccc</span>
      <span id="jsVersion">4.11</span>
    </div> -->
    <div id="info" style="position: absolute; right: 15px; top: 15px;">
        <span>4.11</span>
    </div>
  </body>
</html>
